<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sign-In - Get ID Token</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        button {
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #357ae8;
        }
        #appleButton {
            background-color: #000;
        }
        #appleButton:hover {
            background-color: #333;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
            border-left: 4px solid #4285f4;
            word-break: break-all;
        }
        .result h3 {
            margin-top: 0;
            color: #4285f4;
        }
        .token-display {
            background-color: #fff;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .copy-btn {
            background-color: #34a853;
            margin-top: 10px;
        }
        .copy-btn:hover {
            background-color: #2d8f47;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Google & Apple Sign-In - Get ID Token</h1>
        <p>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠ login ‡πÅ‡∏•‡∏∞‡∏î‡∏π id_token</p>
        
        <!-- Instructions -->
        <div style="background-color: #e7f3ff; padding: 15px; border-radius: 5px; margin-bottom: 20px; border-left: 4px solid #2196F3;">
            <strong>üìã ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤:</strong>
            <ol style="margin: 10px 0; padding-left: 20px;">
                <li>‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå HTML ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô text editor</li>
                <li>‡∏´‡∏≤ <code>GOOGLE_CLIENT_ID</code> ‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏õ‡πá‡∏ô Client ID ‡∏à‡∏≤‡∏Å Firebase Console</li>
                <li>‡∏´‡∏≤‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å: <strong>Firebase Console > Project Settings > General > Your apps > Web app</strong></li>
                <li><strong>‚ö†Ô∏è ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:</strong> ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° Authorized JavaScript origins ‡πÉ‡∏ô Firebase Console (‡∏î‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á)</li>
            </ol>
        </div>
        
        <!-- Origin Mismatch Warning -->
        <div id="originWarning" style="background-color: #fff3cd; padding: 15px; border-radius: 5px; margin-bottom: 20px; border-left: 4px solid #ffc107; display: none;">
            <strong>‚ö†Ô∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Error: origin_mismatch</strong>
            <p style="margin: 10px 0 0 0; font-size: 14px;">
                <strong>Current Origin:</strong> <code id="currentOrigin"></code><br>
                <strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:</strong> ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Firebase Console > Authentication > Settings > Authorized domains<br>
                ‡∏´‡∏£‡∏∑‡∏≠ Google Cloud Console > APIs & Services > Credentials > OAuth 2.0 Client IDs<br>
                ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏û‡∏¥‡πà‡∏° origin ‡∏ô‡∏µ‡πâ: <code id="originToAdd"></code>
            </p>
        </div>
        
        <!-- Google Sign-In Button -->
        <div id="googleSignInButton"></div>
        
        <!-- Apple Sign-In Button -->
        <button id="appleButton" onclick="signInWithApple()">
            üçé Sign in with Apple
        </button>
        <p style="font-size: 12px; color: #666; margin-top: 5px;">
            <small>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: Apple Sign-In ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ HTTPS ‡∏´‡∏£‡∏∑‡∏≠ localhost ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</small>
        </p>
        
        <!-- Result Display -->
        <div id="result" class="result" style="display: none;">
            <h3>‚úÖ ID Token:</h3>
            <div id="tokenDisplay" class="token-display"></div>
            <button class="copy-btn" onclick="copyToken()">üìã Copy Token</button>
            <div style="margin-top: 15px;">
                <h3>üìù Provider Info:</h3>
                <div id="providerInfo"></div>
            </div>
        </div>
    </div>

    <!-- Google Sign-In Script -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <!-- Apple Sign-In Script -->
    <script type="text/javascript" src="https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js"></script>
    
    <script>
        // Google Client ID - ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Client ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏≤‡∏Å Firebase Console
        // ‡∏´‡∏≤‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å: Firebase Console > Project Settings > General > Your apps > Web app
        // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: '123456789-abcdefghijklmnop.apps.googleusercontent.com'
        const GOOGLE_CLIENT_ID = '266274251473-e88r4lf2g36gfigqdn31tm0rdij6pi1p.apps.googleusercontent.com';
        
        // Apple Service ID - ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Service ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Apple Sign-In)
        const APPLE_SERVICE_ID = 'th.co.mfec.appsol.firebasetest';
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Google Client ID ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
        function checkGoogleClientID() {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà placeholder ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
            if (GOOGLE_CLIENT_ID === 'YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com' || 
                GOOGLE_CLIENT_ID === '' || 
                !GOOGLE_CLIENT_ID.includes('.apps.googleusercontent.com')) {
                return false;
            }
            return true;
        }
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Origin ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç origin_mismatch
        function showOriginInfo() {
            const currentOrigin = window.location.origin;
            const originWarning = document.getElementById('originWarning');
            const currentOriginSpan = document.getElementById('currentOrigin');
            const originToAddSpan = document.getElementById('originToAdd');
            
            if (currentOriginSpan) {
                currentOriginSpan.textContent = currentOrigin;
            }
            if (originToAddSpan) {
                originToAddSpan.textContent = currentOrigin;
            }
            if (originWarning) {
                originWarning.style.display = 'block';
            }
        }
        
        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Google Sign-In
        window.onload = function() {
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Origin
            showOriginInfo();
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Google Client ID
            if (!checkGoogleClientID()) {
                const buttonContainer = document.getElementById("googleSignInButton");
                buttonContainer.innerHTML = `
                    <div style="padding: 15px; background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 5px; color: #856404;">
                        <strong>‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Client ID</strong><br>
                        <small>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç GOOGLE_CLIENT_ID ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå HTML<br>
                        ‡∏´‡∏≤‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å: Firebase Console > Project Settings > General > Your apps > Web app</small>
                    </div>
                `;
                return;
            }
            
            // ‡∏£‡∏≠‡πÉ‡∏´‡πâ Google SDK ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
            function initGoogleSignIn() {
                if (typeof google !== 'undefined' && google.accounts && google.accounts.id) {
                    try {
                        google.accounts.id.initialize({
                            client_id: GOOGLE_CLIENT_ID,
                            callback: handleGoogleSignIn,
                            auto_select: false,
                            cancel_on_tap_outside: true
                        });
                        
                        google.accounts.id.renderButton(
                            document.getElementById("googleSignInButton"),
                            { 
                                theme: "outline", 
                                size: "large",
                                width: 300,
                                text: "signin_with"
                            }
                        );
                    } catch (error) {
                        console.error('Google Sign-In initialization error:', error);
                        const buttonContainer = document.getElementById("googleSignInButton");
                        const errorMessage = error.message || error;
                        const isOriginMismatch = errorMessage.includes('origin_mismatch') || 
                                                 errorMessage.includes('origin') ||
                                                 errorMessage.includes('400');
                        
                        if (isOriginMismatch) {
                            buttonContainer.innerHTML = `
                                <div style="padding: 15px; background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 5px; color: #856404;">
                                    <strong>‚ö†Ô∏è Error: origin_mismatch</strong><br>
                                    <small>‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° Authorized JavaScript origin ‡πÉ‡∏ô Firebase Console</small><br>
                                    <strong>Current Origin:</strong> <code>${window.location.origin}</code><br>
                                    <small style="margin-top: 10px; display: block;">
                                        <strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:</strong><br>
                                        1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Firebase Console > Authentication > Settings > Authorized domains<br>
                                        2. ‡∏´‡∏£‡∏∑‡∏≠ Google Cloud Console > APIs & Services > Credentials<br>
                                        3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å OAuth 2.0 Client ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì<br>
                                        4. ‡πÄ‡∏û‡∏¥‡πà‡∏° Authorized JavaScript origins: <code>${window.location.origin}</code>
                                    </small>
                                </div>
                            `;
                        } else {
                            buttonContainer.innerHTML = `
                                <div style="padding: 15px; background-color: #f8d7da; border: 1px solid #dc3545; border-radius: 5px; color: #721c24;">
                                    <strong>‚ùå Error: ${errorMessage}</strong><br>
                                    <small>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Google Client ID ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</small>
                                </div>
                            `;
                        }
                    }
                } else {
                    // ‡∏£‡∏≠‡∏≠‡∏µ‡∏Å‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à
                    setTimeout(initGoogleSignIn, 100);
                }
            }
            
            initGoogleSignIn();
        };

        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Google Sign-In Response
        function handleGoogleSignIn(response) {
            console.log('Google Sign-In Response:', response);
            
            // id_token ‡∏°‡∏≤‡∏à‡∏≤‡∏Å response.credential
            const idToken = response.credential;
            
            // Log id_token ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤
            console.log('=== GOOGLE ID TOKEN ===');
            console.log(idToken);
            console.log('======================');
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
            displayToken(idToken, 'google.com');
        }

        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Apple Sign-In
        function signInWithApple() {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Apple Service ID ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
            if (APPLE_SERVICE_ID === 'th.co.mfec.appsol.firebasetest' || APPLE_SERVICE_ID === '') {
                alert('‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Apple Service ID\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç APPLE_SERVICE_ID ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå HTML');
                return;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ browser ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Apple Sign-In ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (typeof AppleID === 'undefined') {
                alert('‚ùå Browser ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Apple Sign-In ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÇ‡∏´‡∏•‡∏î Apple SDK\n\n‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: Apple Sign-In ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ HTTPS ‡∏´‡∏£‡∏∑‡∏≠ localhost ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
                return;
            }
            
            try {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô HTTPS ‡∏´‡∏£‡∏∑‡∏≠ localhost ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                if (window.location.protocol !== 'https:' && 
                    window.location.hostname !== 'localhost' && 
                    window.location.hostname !== '127.0.0.1') {
                    alert('‚ö†Ô∏è Apple Sign-In ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ HTTPS ‡∏´‡∏£‡∏∑‡∏≠ localhost ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ú‡πà‡∏≤‡∏ô HTTPS ‡∏´‡∏£‡∏∑‡∏≠ localhost');
                    return;
                }
                
                // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Apple Sign-In
                AppleID.auth.init({
                    clientId: APPLE_SERVICE_ID,
                    scope: 'name email',
                    redirectURI: window.location.origin,
                    usePopup: true
                });

                AppleID.auth.signIn({
                    requestedScopes: ['name', 'email']
                }).then((response) => {
                    console.log('Apple Sign-In Response:', response);
                    
                    // id_token ‡∏°‡∏≤‡∏à‡∏≤‡∏Å response.id_token ‡∏´‡∏£‡∏∑‡∏≠ response.authorization.id_token
                    const idToken = response.id_token || (response.authorization && response.authorization.id_token);
                    
                    if (!idToken) {
                        console.error('Apple Sign-In Response:', response);
                        alert('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö id_token ‡πÉ‡∏ô response\n‡∏î‡∏π Console ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î');
                        return;
                    }
                    
                    // Log id_token ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤
                    console.log('=== APPLE ID TOKEN ===');
                    console.log(idToken);
                    console.log('======================');
                    
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
                    displayToken(idToken, 'apple.com');
                }).catch((error) => {
                    console.error('Apple Sign-In Error:', error);
                    alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ login ‡∏î‡πâ‡∏ß‡∏¢ Apple:\n' + (error.message || error));
                });
            } catch (error) {
                console.error('Apple Sign-In initialization error:', error);
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Apple Sign-In:\n' + error.message);
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á Token ‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
        function displayToken(token, providerId) {
            const resultDiv = document.getElementById('result');
            const tokenDisplay = document.getElementById('tokenDisplay');
            const providerInfo = document.getElementById('providerInfo');
            
            tokenDisplay.textContent = token;
            providerInfo.innerHTML = `
                <p><strong>Provider:</strong> ${providerId}</p>
                <p><strong>Token Length:</strong> ${token.length} characters</p>
                <p><strong>Token Preview:</strong> ${token.substring(0, 50)}...</p>
            `;
            
            resultDiv.style.display = 'block';
            
            // Scroll to result
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // Copy Token to Clipboard
        function copyToken() {
            const tokenDisplay = document.getElementById('tokenDisplay');
            const token = tokenDisplay.textContent;
            
            navigator.clipboard.writeText(token).then(() => {
                alert('‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Token ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
            }).catch(err => {
                console.error('Failed to copy:', err);
                // Fallback: Select text
                const range = document.createRange();
                range.selectNode(tokenDisplay);
                window.getSelection().removeAllRanges();
                window.getSelection().addRange(range);
                document.execCommand('copy');
                alert('‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Token ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
            });
        }
    </script>
</body>
</html>

